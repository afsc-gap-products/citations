---
title: "Check bibliography output"
output: 
  pdf_document
  # word_document
date: "`r paste0(format(Sys.time(), '%B %d, %Y'))`"
csl: "https://raw.githubusercontent.com/citation-style-language/styles/master/apa-no-ampersand.csl"
bibliography: "../cite/bibliography.bib"
---


```{r, echo = FALSE}
bibfiletext <- readLines(con = paste0("../cite/bibliography.bib"))

output_citations <- function(bibfiletext, 
                             year = NULL) {
  
  bibfiletext0 <- bibfiletext
  cite_start <- grep(pattern = "@", x = bibfiletext0, fixed = TRUE)
  
  cite_start0 <- c()
  if (!is.null(year)) {
    for (i in 1:length(year)){
      cite_year <- grep(pattern = paste0("year = {",year[i],"}"), 
                        x = bibfiletext0, fixed = TRUE)
      cite_year0 <- c()
      for (ii in 1:length(cite_year)) {
        temp <- which(cite_start<cite_year[ii])
        cite_year0 <- c(cite_year0, 
                        cite_start[length(temp)])
      }
      cite_start0 <- c(cite_start0, cite_year0)
    }
   cite_start <- cite_start0
  }
  
  
bibfiletext0 <- bibfiletext0[cite_start]
bibfiletext0 <- unlist(lapply(X = strsplit(split = "{", x = bibfiletext0, fixed = TRUE), "[[", 2))
# bibfiletext0 <- gsub(pattern = "@*\\{", replacement = "", x = bibfiletext0)
bibfiletext0 <- gsub(pattern = ",", replacement = "", x = bibfiletext0, fixed = TRUE)
bibfiletext0 <- trimws(bibfiletext0)

b <- unlist(paste0(
            "@", unlist(bibfiletext0), 
"

", 
            collapse = ""))
return(b)
}

b <- output_citations(bibfiletext = bibfiletext)
```

## All in-line text citations

`r b`

## Works cited

<div id="refs"></div>

## All in-line text citations from 2022

```{r, echo = FALSE}
# Test
b <- output_citations(bibfiletext = bibfiletext, year = 2021:2022)
```

`r b`



